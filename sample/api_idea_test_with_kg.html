<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Idea CDKG Interface</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/force-graph@1.43.4/dist/force-graph.min.js"></script>
  <link rel="stylesheet" href="css/kg_graph.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="header-icon">
          <i class="fas fa-code-compare"></i>
        </div>
        <div class="header-text">
          <h1>Idea CDKG</h1>
          <p class="subtitle">Compare <code>/definition_request_idea_new_cdkg</code> vs
            <code>/definition_request_idea_new</code> vs <code>/chatgpt_answer</code>
          </p>
        </div>
      </div>
    </header>

    <div class="input-section">
      <div class="section-header">
        <i class="fas fa-cog"></i>
        <h3>Configuration</h3>
      </div>

      <div class="session-info">
        <div class="input-group">
          <label for="user_id_input">
            <i class="fas fa-user"></i>
            User ID
          </label>
          <input id="user_id_input" type="text" value="686e1e6784d458dd45380624" />
        </div>
        <div class="input-group">
          <label for="block_id_input">
            <i class="fas fa-cube"></i>
            Block ID
          </label>
          <input id="block_id_input" type="text" value="686fabbbcf5f84a5c8fc60af" />
        </div>
      </div>

      <div class="input-group">
        <label for="user_input">
          <i class="fas fa-edit"></i>
          User Input
        </label>
        <textarea id="user_input" rows="4"
          placeholder="Enter your request...">Cancer treatments damage healthy cells, alongside cancer cells</textarea>
      </div>

      <div class="input-group">
        <label for="api-function-select">
          <i class="fas fa-gear"></i>
          API Function
        </label>
        <select id="api-function-select">
          <option value="generate_title">generate_title - Get title for the idea</option>
          <option value="generate_abstract">generate_abstract - Get abstract for the idea</option>
          <option value="get_stakeholders">get_stakeholders - Get stakeholders for the idea</option>
          <option value="update_stakeholders">update_stakeholders - Update stakeholder information</option>
          <option value="generate_tags_and_type">generate_tags_and_type - Generate tags and types</option>
          <option value="get_idea_impact">get_idea_impact - Get potential impact of the idea</option>
          <option value="get_assumptions">get_assumptions - List assumptions about the idea</option>
          <option value="results_to_assumptions">results_to_assumptions - Convert results into assumptions</option>
          <option value="get_constraints">get_constraints - Identify constraints for the idea</option>
          <option value="get_risks">get_risks - Identify risks for the idea</option>
          <option value="get_areas_analysis">get_areas_analysis - Analyze key areas for development</option>
          <option value="get_connection">get_connection - Find related connections</option>
          <option value="get_idea_classification">get_idea_classification - Classify the idea</option>
          <option value="show_think_models">show_think_models - Show thinking models</option>
          <option value="execute_CREAT_MODEL">execute_CREAT_MODEL - Execute a custom model</option>
          <option value="execute_idea_landscape">execute_idea_landscape - Generate idea landscape</option>
          <option value="execute_attribute_analysis">execute_attribute_analysis - Perform attribute analysis</option>
          <option value="execute_cross_domain_analysis">execute_cross_domain_analysis - Analyze across domains</option>
          <option value="execute_biomimicry_analysis">execute_biomimicry_analysis - Apply biomimicry thinking</option>
          <option value="execute_analogical_thinking_analysis">execute_analogical_thinking_analysis - Use analogical
            thinking</option>
          <option value="execute_morphological_analysis">execute_morphological_analysis - Do morphological analysis
          </option>
          <option value="execute_fusion_analysis">execute_fusion_analysis - Run fusion analysis</option>
          <option value="execute_prism_model">execute_prism_model - Run PRISM model analysis</option>
          <option value="get_final_summary">get_final_summary - Summarize the full idea</option>
        </select>
      </div>

      <button onclick="sendRequest()" class="run-button">
        <i class="fas fa-play"></i>
        Run Comparison
      </button>
    </div>

    <div class="results-section">
      <div class="section-header">
        <i class="fas fa-chart-line"></i>
        <h3>CDKG vs Vanilla vs OpenAI Response Comparison</h3>
      </div>

      <div class="api-results">
        <div class="result-card">
          <div class="result-header">
            <div class="api-badge normal_llm">
              <i class="fas fa-robot"></i>
              OpenAI (ChatGPT)
            </div>
            <div class="status-indicator" id="status_3">
              <i class="fas fa-clock"></i>
              Waiting
            </div>
          </div>
          <div class="result-content-wrapper">
            <div id="response_3" class="result-content">Waiting for request...</div>
          </div>
        </div>

        <div class="result-card">
          <div class="result-header">
            <div class="api-badge legacy">
              <i class="fas fa-cogs"></i>
              Kraft
            </div>
            <div class="status-indicator" id="status_2">
              <i class="fas fa-clock"></i>
              Waiting
            </div>
          </div>
          <div class="result-content-wrapper">
            <div id="response_2" class="result-content">Waiting for request...</div>
          </div>
        </div>

        <div class="result-card">
          <div class="result-header">
            <div class="api-badge new">
              <i class="fas fa-rocket"></i>
              Kraft with CDKG
            </div>
            <div class="status-indicator" id="status_1">
              <i class="fas fa-clock"></i>
              Waiting
            </div>
          </div>
          <div class="result-content-wrapper">
            <div id="response_1" class="result-content">Waiting for request...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Knowledge Graph Section -->
    <div id="kg-section" class="kg-section" style="display: none;">
      <div class="section-header">
        <i class="fas fa-project-diagram"></i>
        <h3>Knowledge Graph Visualization</h3>
      </div>

      <div class="kg-header">
        <div class="kg-controls">
          <div class="search-controls">
            <div class="search-input-wrapper">
              <i class="fas fa-search"></i>
              <input type="text" id="node-search" placeholder="Search nodes..." />
            </div>
            <button onclick="searchNodes()" class="search-btn">
              <i class="fas fa-search"></i>
              Search
            </button>
            <button onclick="clearSearch()" class="clear-btn">
              <i class="fas fa-times"></i>
              Clear
            </button>
          </div>

          <div class="filter-controls">
            <div class="filter-group">
              <label><i class="fas fa-layer-group"></i> Domain</label>
              <select id="domain-filter" onchange="filterByDomain(this.value)">
                <option value="all">All Domains</option>
              </select>
            </div>
            <div class="filter-group">
              <label><i class="fas fa-tag"></i> Type</label>
              <select id="node-type-filter" onchange="filterByNodeType(this.value)">
                <option value="all">All Types</option>
                <option value="knowledge">Knowledge</option>
                <option value="assignee">Assignee</option>
                <option value="keyword">Keyword</option>
                <option value="technology">Technology</option>
              </select>
            </div>
          </div>

          <div class="view-controls">
            <button class="view-btn active" data-view="graph" onclick="switchView('graph')">
              <i class="fas fa-share-alt"></i>
              Graph View
            </button>
            <button class="view-btn" data-view="cards" onclick="switchView('cards')">
              <i class="fas fa-th-large"></i>
              Card View
            </button>
          </div>
        </div>
      </div>

      <div class="kg-content">
        <div class="kg-visualization">
          <div id="graph-container" class="graph-container">
            <div class="loading-placeholder">
              <div class="spinner"></div>
              <p>Loading Knowledge Graph...</p>
            </div>
          </div>
          <div id="data-cards-container" class="data-cards-container" style="display: none;">
            <!-- Cards will be generated here -->
          </div>
        </div>

        <div class="kg-insights">
          <h3>
            <i class="fas fa-lightbulb"></i>
            Graph Insights
          </h3>
          <div id="insights-content" class="insights-content">
            <div class="loading-placeholder">
              <p>Insights will appear after graph generation</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Console Log Panel -->
    <div class="console-panel">
      <div class="console-header">
        <h3>
          <i class="fas fa-terminal"></i>
          Process Log
        </h3>
        <div class="console-actions">
          <button onclick="toggleConsole()" class="toggle-console-btn">
            <i class="fas fa-chevron-up"></i>
          </button>
          <button onclick="clearLogs()" class="clear-logs-btn">
            <i class="fas fa-trash"></i>
            Clear
          </button>
        </div>
      </div>
      <div id="console-log" class="console-log">
        <div class="log-entry system">
          <span class="log-time">System</span>
          <span class="log-message">API Comparison Interface ready</span>
        </div>
      </div>
    </div>

    <!-- Full JSON Sections -->
    <div class="json-section">
      <div class="json-header">
        <h3>
          <i class="fas fa-code"></i>
          Full JSON Response - <code>/definition_request_idea_new_cdkg</code>
        </h3>
        <div class="json-actions">
          <button onclick="copyJsonContent('full_json')" class="copy-json-btn">
            <i class="fas fa-copy"></i>
            Copy
          </button>
          <button onclick="toggleJsonSection('json-section-1')" class="collapse-btn">
            <i class="fas fa-chevron-up"></i>
          </button>
        </div>
      </div>
      <div id="json-section-1" class="json-content-wrapper">
        <pre id="full_json" class="json-content">Waiting...</pre>
      </div>
    </div>

    <div class="json-section">
      <div class="json-header">
        <h3>
          <i class="fas fa-code"></i>
          Full JSON Response - <code>/definition_request_idea_new</code>
        </h3>
        <div class="json-actions">
          <button onclick="copyJsonContent('full_json_2')" class="copy-json-btn">
            <i class="fas fa-copy"></i>
            Copy
          </button>
          <button onclick="toggleJsonSection('json-section-2')" class="collapse-btn">
            <i class="fas fa-chevron-up"></i>
          </button>
        </div>
      </div>
      <div id="json-section-2" class="json-content-wrapper">
        <pre id="full_json_2" class="json-content">Waiting...</pre>
      </div>
    </div>

    <div class="json-section">
      <div class="json-header">
        <h3>
          <i class="fas fa-code"></i>
          Full JSON Response - <code>/chatgpt_answer</code>
        </h3>
        <div class="json-actions">
          <button onclick="copyJsonContent('full_json_3')" class="copy-json-btn">
            <i class="fas fa-copy"></i>
            Copy
          </button>
          <button onclick="toggleJsonSection('json-section-3')" class="collapse-btn">
            <i class="fas fa-chevron-up"></i>
          </button>
        </div>
      </div>
      <div id="json-section-3" class="json-content-wrapper">
        <pre id="full_json_3" class="json-content">Waiting...</pre>
      </div>
    </div>
  </div>

  <!-- Node Details Modal -->
  <div id="node-details-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="node-details-title">Node Details</h2>
        <span class="close-modal">
          <i class="fas fa-times"></i>
        </span>
      </div>
      <div id="node-details-body" class="modal-body"></div>
      <div class="modal-actions">
        <button onclick="showRelatedNodes()" class="btn-primary">
          <i class="fas fa-project-diagram"></i>
          Show Related
        </button>
        <button onclick="closeModal()" class="btn-secondary">
          <i class="fas fa-times"></i>
          Close
        </button>
      </div>
    </div>
  </div>

  <script>
    function getBaseUrl() {
      const isFileProtocol = window.location.protocol === 'file:';
      return isFileProtocol ? 'http://localhost:8000' : window.location.origin;
    }

    // Configuration
    const CONFIG = {
      API_BASE_URL: getBaseUrl(),
      cdkg_endpoint: 'definition_request_idea_new_cdkg',
      old_endpoint: 'definition_request_idea_new',
      chatgpt_answer: "chatgpt_answer",
      NODE_COLORS: {
        knowledge: '#2563eb',
        assignee: '#059669',
        keyword: '#dc2626',
        technology: '#7c3aed',
        unknown: '#6b7280'
      },
      NODE_SIZES: {
        knowledge: 12,
        assignee: 8,
        keyword: 6,
        technology: 10,
        unknown: 5
      },
      STATUS_ICONS: {
        loading: 'fa-spinner fa-spin',
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        waiting: 'fa-clock'
      }
    };
  </script>
  <script src="js/kg_graph.js"></script>
</body>

</html>